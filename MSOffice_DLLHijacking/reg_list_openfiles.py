#!C:\Python27\python.exe

import sys,os
from _winreg import *
import win32com.client
import glob
import time

Registry = ConnectRegistry(None, HKEY_CLASSES_ROOT)
RawKey = OpenKey(Registry, "CLSID")
print "RawKey"
print(type(RawKey).__name__)
print(type(RawKey).__doc__)
print "EnumValue"
print(EnumValue.__doc__)

rtf_sample_data = """{\\rtf1{\object\objemb{\*\objclass None}{\*\oleclsid \'8d42060D99-fe53-41a2-1111-234511112222\'7d}{\*\objdata 010500000100000001000000000000000000000000000000000000000000000000000000000000000000000000}}}"""

rtf_split = rtf_sample_data.split("'")

clsid_list = []
rtf_data = []
total_clsids=0
fname = ""
s_path = "C:\\Python27\\rtf_malicious\\"
#d_path= "C:\\Python27\\rtf_malicious\\already_opened"
d_path = "C:\\Python27\\rtf_malicious\\tested_rtf\\"

print "reading all *.rtf files at C:\Python27\rtf_malicious"
rtf_file_list = glob.glob("C:\\Python27\\rtf_malicious\\*.rtf")

print "total rtf files:", len(rtf_file_list)

for rfile in rtf_file_list:
	MSWord = win32com.client.Dispatch("Word.Application")
	MSWord.Visible = 0
	print "Opening file:", rfile
	try:
		MSWord.Documents.Open(rfile)
		#os.rename(rfile,"C:\\Python27\\rtf_malicious\\tested_rtf\\")
	except:
		print "Exception opening above files"
		pass
	print "Closing file:", rfile
	MSWord.Documents.Close()
	time.sleep(1)
	
	if not os.path.exists (d_path):
	        os.makedirs(d_path)
	file_name= rfile.split("\\")[-1]
	print "Copying " ,rfile
	print " to " ,d_path+file_name	
	os.rename(rfile,d_path+file_name)     
	
print "Done Opening/Closing all RTF files"	

